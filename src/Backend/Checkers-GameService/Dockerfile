FROM node:lts-alpine

ARG ARG_PORT
ARG ARG_DB_PSW
ARG ARG_GAME_KEY
ARG ARG_GAME_CERT
ARG ARG_CERTIFICATE

ENV GameService_PORT=$ARG_PORT
ENV DB_PSW=$ARG_DB_PSW
ENV GAME_KEY=$ARG_GAME_KEY
ENV GAME_CERT=$ARG_GAME_CERT
ENV CERTIFICATE=$ARG_CERTIFICATE

RUN mkdir -p /app/
WORKDIR /app
COPY . .
RUN npm install --unsafe-perm
RUN npm run gulp build

WORKDIR /app/build
EXPOSE $ARG_PORT
CMD npm run deploy